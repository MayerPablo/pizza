<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pablo and Felix' Pizza Reviews</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üçï Pablo and Felix' Pizza Reviews</h1>
            <p class="subtitle">Rating pizzas, one slice at a time</p>
        </header>

        <div class="rules">
            <h2>The 4 Simple Rules:</h2>
            <ol>
                <li>Every Pizza gets <b>2 ratings from 0.0 to 10.0</b>, one for the general quality of the pizza (GQ) and one for the value offered (VO). Each rating consists of two individual ratings (one from Pablo, one from Felix) and their average.</li>
                <li>The rating scale is normalized to the Freiburger Mensa Institutsviertel Buffet Pizza which is evaluated at:
                    <ul>
                        <li><b>General quality (GQ): 5.0/10</b></li>
                        <li><b>Value offered (VO): 10/10</b></li>
                    </ul>
                </li>
                <li>The ambience of the restaurant, friendliness of the staff, options on the menu, blablabla, [...] <b><ins>do not have any influence</ins></b> on these ratings!</li>
            </ol>
        </div>

        <div class="process">
            <h4>For the interested: our review process</h4>
            <p>We visit each pizzeria and order pizzas. 
                While typically one of us orders a Margherita (to maintain consistency and evaluate the base pizza), 
                the other person orders a different pizzas to sample variety. 
                We then share the Pizza where each takes one halve of the others pizza.
                The General Quality (GQ) rating reflects the overall quality of the pizza regardless of type. 
                The Value Offered (VO) rating considers the price paid relative to quality received. 
                Each reviewer rates independently (without knowing the others rating) based on experience, ensuring authentic individual perspectives. 
                The prices listed reflect what each reviewer paid for their specific pizza.</p>
            </br>
        </div>

        <div class="controls">
            <button class="theme-toggle" onclick="toggleTheme()">üåì Toggle Dark Mode</button>
            <input type="text" class="search-box" placeholder="Search restaurants..." onkeyup="filterTable()">
        </div>

        <div class="table-container">
            <table id="pizzaTable">
                <thead>
                    <tr>
                        <th onclick="sortTable(0)">ID</th>
                        <th onclick="sortTable(1)">Name</th>
                        <th onclick="sortTable(2)">Location</th>
                        <th onclick="sortTable(3)">GQ Avg</th>
                        <th onclick="sortTable(4)">VO Avg</th>
                        <th>Website</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody id="restaurantTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let restaurants = {};

        function calculateAverage(rating) {
            if (rating.pablo === null || rating.felix === null) return "TBD";
            return ((rating.pablo + rating.felix) / 2).toFixed(1);
        }

        async function loadRestaurants() {
            try {
                const response = await fetch('restaurants.json');
                restaurants = await response.json();
                displayRestaurants();
            } catch (error) {
                console.error('Error loading restaurants:', error);
            }
        }

        function displayRestaurants() {
            const tbody = document.getElementById('restaurantTableBody');
            tbody.innerHTML = '';
            
            Object.values(restaurants).forEach(restaurant => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${restaurant.id}</td>
                    <td>${restaurant.name}</td>
                    <td>${restaurant.location}</td>
                    <td class="rating">${calculateAverage(restaurant.gq)}</td>
                    <td class="rating">${calculateAverage(restaurant.vo)}</td>
                    <td><a href="${restaurant.website}" target="_blank">Visit</a></td>
                    <td><a href="review_template.html?id=${restaurant.id}">View Review</a></td>
                `;
                tbody.appendChild(row);
            });
        }

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);

        let sortDirection = {};

        function sortTable(columnIndex) {
            const table = document.getElementById('pizzaTable');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            sortDirection[columnIndex] = sortDirection[columnIndex] === 'asc' ? 'desc' : 'asc';
            
            const headers = table.querySelectorAll('th');
            headers.forEach(h => h.className = '');
            headers[columnIndex].className = 'sort-' + sortDirection[columnIndex];
            
            rows.sort((a, b) => {
                let aVal = a.cells[columnIndex].textContent.trim();
                let bVal = b.cells[columnIndex].textContent.trim();
                
                const aNum = parseFloat(aVal);
                const bNum = parseFloat(bVal);
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return sortDirection[columnIndex] === 'asc' ? aNum - bNum : bNum - aNum;
                }
                
                return sortDirection[columnIndex] === 'asc' 
                    ? aVal.localeCompare(bVal) 
                    : bVal.localeCompare(aVal);
            });
            
            rows.forEach(row => tbody.appendChild(row));
        }

        function filterTable() {
            const input = document.querySelector('.search-box');
            const filter = input.value.toLowerCase();
            const table = document.getElementById('pizzaTable');
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        }

        loadRestaurants();
    </script>
</body>
</html>